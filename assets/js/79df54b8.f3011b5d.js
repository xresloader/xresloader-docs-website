"use strict";(self.webpackChunkxresloader_docs=self.webpackChunkxresloader_docs||[]).push([[364],{5479:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>s,default:()=>i,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"users/xres-code-generator/lua-protobuf","title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08lua-protobuf \u8fd0\u884c\u65f6\uff09","description":"\u4f7f\u7528 xres-code-generator \u7ed3\u5408 lua-protobuf \u6a21\u5757\u8bfb\u53d6\u5bfc\u51fa\u7684\u914d\u7f6e\u6570\u636e","source":"@site/docs/users/xres-code-generator/lua-protobuf.md","sourceDirName":"users/xres-code-generator","slug":"/users/xres-code-generator/lua-protobuf","permalink":"/docs/users/xres-code-generator/lua-protobuf","draft":false,"unlisted":false,"editUrl":"https://github.com/xresloader/xresloader-docs/edit/main/docs/users/xres-code-generator/lua-protobuf.md","tags":[],"version":"current","frontMatter":{"title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08lua-protobuf \u8fd0\u884c\u65f6\uff09","description":"\u4f7f\u7528 xres-code-generator \u7ed3\u5408 lua-protobuf \u6a21\u5757\u8bfb\u53d6\u5bfc\u51fa\u7684\u914d\u7f6e\u6570\u636e"},"sidebar":"docsSidebar","previous":{"title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08upb \u8fd0\u884c\u65f6\uff09","permalink":"/docs/users/xres-code-generator/lua-upb"},"next":{"title":"xresloader \u6838\u5fc3\u529f\u80fd","permalink":"/docs/users/xresloader-core"}}');var a=n(7259),t=n(5739);const l={title:"Lua \u8bfb\u8868\u4ee3\u7801\uff08lua-protobuf \u8fd0\u884c\u65f6\uff09",description:"\u4f7f\u7528 xres-code-generator \u7ed3\u5408 lua-protobuf \u6a21\u5757\u8bfb\u53d6\u5bfc\u51fa\u7684\u914d\u7f6e\u6570\u636e"},s="Lua\uff08lua-protobuf\uff09\u96c6\u6210\u6307\u5357",c={},d=[{value:"\u51c6\u5907\u4e0e\u751f\u6210",id:"\u51c6\u5907\u4e0e\u751f\u6210",level:2},{value:"\u793a\u4f8b\u8c03\u7528",id:"\u793a\u4f8b\u8c03\u7528",level:2},{value:"\u6838\u5fc3\u63a5\u53e3",id:"\u6838\u5fc3\u63a5\u53e3",level:2}];function u(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"lualua-protobuf\u96c6\u6210\u6307\u5357",children:"Lua\uff08lua-protobuf\uff09\u96c6\u6210\u6307\u5357"})}),"\n",(0,a.jsx)(r.h2,{id:"\u51c6\u5907\u4e0e\u751f\u6210",children:"\u51c6\u5907\u4e0e\u751f\u6210"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:["\u6784\u5efa\u5e76\u5b89\u88c5 ",(0,a.jsx)(r.a,{href:"https://github.com/starwing/lua-protobuf",children:"lua-protobuf"}),"\uff0c\u786e\u4fdd ",(0,a.jsx)(r.code,{children:"pb"})," \u6a21\u5757\u53ef\u88ab ",(0,a.jsx)(r.code,{children:"require"}),"\u3002"]}),"\n",(0,a.jsx)(r.li,{children:"\u590d\u5236\u8fd0\u884c\u65f6\u4ee3\u7801\u5e76\u751f\u6210\u8bfb\u8868\u7d22\u5f15\uff1a"}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:'REPO_DIR=$PATH_TO_xres_code_generator\nmkdir -p "$REPO_DIR/sample/lua-protobuf"\ncp -rvf "$REPO_DIR/template/common/lua-protobuf/"*.lua "$REPO_DIR/sample/lua-protobuf"\ncp -rvf "$REPO_DIR/template/common/lua/vardump.lua" "$REPO_DIR/sample/lua-protobuf"\n\nPYTHON_BIN="$(which python3 2>/dev/null || which python)"\n"$PYTHON_BIN" "$REPO_DIR/xrescode-gen.py" \\\n    -i "$REPO_DIR/template" \\\n    -p "$REPO_DIR/sample/sample.pb" \\\n    -o "$REPO_DIR/sample/lua-protobuf" \\\n    -g "$REPO_DIR/template/DataTableCustomIndexUpb.lua.mako:DataTableCustomIndexLuaProtobuf.lua" \\\n    "$@"\n'})}),"\n",(0,a.jsx)(r.h2,{id:"\u793a\u4f8b\u8c03\u7528",children:"\u793a\u4f8b\u8c03\u7528"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-lua",children:"local pb = require('pb')\n\nlocal function load_pb(file_path)\n    local f = assert(io.open(file_path, 'rb'))\n    pb.load(f:read('a'))\n    f:close()\nend\n\nload_pb('pb_header_v3.pb')\nload_pb('sample.pb')\n\nlocal excel_config_service = require('DataTableServiceLuaProtobuf')\nexcel_config_service:ReloadTables()\n\nlocal current_group = excel_config_service:GetCurrentGroup()\nlocal role_upgrade_cfg = excel_config_service:GetByGroup(current_group, 'role_upgrade_cfg')\nfor _, v in ipairs(role_upgrade_cfg:GetByIndex('id', 10001)) do\n    print(string.format('\\tid=%s, level=%s', tostring(v.Id), tostring(v.Level)))\nend\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u6838\u5fc3\u63a5\u53e3",children:"\u6838\u5fc3\u63a5\u53e3"}),"\n",(0,a.jsxs)(r.p,{children:["lua-protobuf \u8fd0\u884c\u65f6\u6cbf\u7528\u4e0e upb \u7248\u4e00\u81f4\u7684\u670d\u52a1/\u7d22\u5f15 API\uff0c\u53ea\u662f\u89e3\u7801\u4ea4\u7531 ",(0,a.jsx)(r.code,{children:"pb"})," \u6a21\u5757\u5b8c\u6210\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-lua",children:'local DataTableService = {\n    BufferLoader = function(path)\n        local f = assert(io.open(path, "rb"))\n        local data = f:read("a"); f:close(); return data\n    end\n}\n\nfunction DataTableService:ReloadTables()\n    self.__current_group = self:LoadTables(function(desc, bytes)\n        return pb.decode(desc, bytes)\n    end)\nend\n'})}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"DataTableSet"})," \u4e5f\u4f1a\u66b4\u9732 ",(0,a.jsx)(r.code,{children:"GetByIndex"}),"\u3001",(0,a.jsx)(r.code,{children:"ContainsIndex"}),"\u3001",(0,a.jsx)(r.code,{children:"GetMessageDescriptor"})," \u7b49\u65b9\u6cd5\uff0c\u4fbf\u4e8e\u904d\u5386\u5b57\u6bb5\u6216\u8c03\u8bd5\u7ed3\u6784\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-lua",children:"function DataTableSet:GetByIndex(index_name, ...)\n    -- \u8fd4\u56de list/map\uff0c\u5143\u7d20\u4e3a pb.decode \u540e\u7684 table\nend\n\nfunction DataTableSet:GetMessageDescriptor()\n    return self.__message_descriptor\nend\n"})})]})}function i(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},5739:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>s});var o=n(6363);const a={},t=o.createContext(a);function l(e){const r=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),o.createElement(t.Provider,{value:r},e.children)}}}]);