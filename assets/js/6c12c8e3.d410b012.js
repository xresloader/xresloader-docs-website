"use strict";(self.webpackChunkxresloader_docs=self.webpackChunkxresloader_docs||[]).push([[186],{5707:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>i,frontMatter:()=>s,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"users/xres-code-generator/lua-upb","title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08upb \u8fd0\u884c\u65f6\uff09","description":"\u4f7f\u7528 xres-code-generator \u751f\u6210\u57fa\u4e8e upb \u7684 Lua \u914d\u7f6e\u8bfb\u53d6\u670d\u52a1","source":"@site/docs/users/xres-code-generator/lua-upb.md","sourceDirName":"users/xres-code-generator","slug":"/users/xres-code-generator/lua-upb","permalink":"/docs/users/xres-code-generator/lua-upb","draft":false,"unlisted":false,"editUrl":"https://github.com/xresloader/xresloader-docs/edit/main/docs/users/xres-code-generator/lua-upb.md","tags":[],"version":"current","frontMatter":{"title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08upb \u8fd0\u884c\u65f6\uff09","description":"\u4f7f\u7528 xres-code-generator \u751f\u6210\u57fa\u4e8e upb \u7684 Lua \u914d\u7f6e\u8bfb\u53d6\u670d\u52a1"},"sidebar":"docsSidebar","previous":{"title":"C# / Unity \u8bfb\u8868\u4ee3\u7801","permalink":"/docs/users/xres-code-generator/csharp"},"next":{"title":"Lua \u8bfb\u8868\u4ee3\u7801\uff08lua-protobuf \u8fd0\u884c\u65f6\uff09","permalink":"/docs/users/xres-code-generator/lua-protobuf"}}');var t=a(7259),l=a(5739);const s={title:"Lua \u8bfb\u8868\u4ee3\u7801\uff08upb \u8fd0\u884c\u65f6\uff09",description:"\u4f7f\u7528 xres-code-generator \u751f\u6210\u57fa\u4e8e upb \u7684 Lua \u914d\u7f6e\u8bfb\u53d6\u670d\u52a1"},o="Lua\uff08upb\uff09\u96c6\u6210\u6307\u5357",c={},u=[{value:"\u51c6\u5907\u4e0e\u751f\u6210",id:"\u51c6\u5907\u4e0e\u751f\u6210",level:2},{value:"\u793a\u4f8b\u8c03\u7528",id:"\u793a\u4f8b\u8c03\u7528",level:2},{value:"\u6838\u5fc3\u63a5\u53e3",id:"\u6838\u5fc3\u63a5\u53e3",level:2},{value:"DataTableServiceUpb",id:"datatableserviceupb",level:3},{value:"DataTableSet\uff08upb\uff09",id:"datatablesetupb",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"luaupb\u96c6\u6210\u6307\u5357",children:"Lua\uff08upb\uff09\u96c6\u6210\u6307\u5357"})}),"\n",(0,t.jsx)(n.h2,{id:"\u51c6\u5907\u4e0e\u751f\u6210",children:"\u51c6\u5907\u4e0e\u751f\u6210"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'REPO_DIR=$PATH_TO_xres_code_generator\nmkdir -p "$REPO_DIR/sample/upblua"\ncp -rvf "$REPO_DIR/template/common/upblua/"*.lua "$REPO_DIR/sample/upblua"\ncp -rvf "$REPO_DIR/template/common/lua/vardump.lua" "$REPO_DIR/sample/upblua"\n"$PROTOC_BIN" "--lua_out=$REPO_DIR/sample/upblua" \\\n    --plugin=protoc-gen-lua=<PATH_TO_protoc-gen-lua> \\\n    "$REPO_DIR/pb_extension/xrescode_extensions_v3.proto" \\\n    "$REPO_DIR/sample/proto/"*.proto\n\nPYTHON_BIN="$(which python3 2>/dev/null || which python)"\n"$PYTHON_BIN" "$REPO_DIR/xrescode-gen.py" \\\n    -i "$REPO_DIR/template" \\\n    -p "$REPO_DIR/sample/sample.pb" \\\n    -o "$REPO_DIR/sample/upblua" \\\n    -g "$REPO_DIR/template/DataTableCustomIndexUpb.lua.mako" \\\n    "$@"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u793a\u4f8b\u8c03\u7528",children:"\u793a\u4f8b\u8c03\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"local excel_config_service = require('DataTableServiceUpb')\nlocal upb = require('upb')\nexcel_config_service:ReloadTables()\n\nlocal role_upgrade_cfg = excel_config_service:Get('role_upgrade_cfg')\nlocal data = role_upgrade_cfg:GetByIndex('id_level', 10001, 3)\nprint(upb.json_encode(data, { upb.JSONENC_PROTONAMES }))\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6838\u5fc3\u63a5\u53e3",children:"\u6838\u5fc3\u63a5\u53e3"}),"\n",(0,t.jsx)(n.h3,{id:"datatableserviceupb",children:"DataTableServiceUpb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local DataTableService = {\n    BufferLoader = function(file_path)\n        local f = assert(io.open(file_path, "rb"))\n        local data = f:read("a"); f:close(); return data\n    end,\n    VersionLoader = function() return "" end,\n    OnError = function(msg, ...) print("[ERROR]", msg, ...) end,\n    OnInfo = function(msg, ...) print("[INFO]", msg, ...) end,\n}\n\nfunction DataTableService:Get(loader_name)\n    return self.__current_group[loader_name]\nend\n\nfunction DataTableService:ReloadTables()\n    self.__current_group = self:LoadTables()\nend\n'})}),"\n",(0,t.jsx)(n.h3,{id:"datatablesetupb",children:"DataTableSet\uff08upb\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function DataTableSet:GetByIndex(index_name, ...)\n    -- \u6309\u7d22\u5f15\u8fd4\u56de\u5217\u8868\u6216\u5355\u6761\u8bb0\u5f55\nend\n\nfunction DataTableSet:ContainsIndex(index_name, ...)\n    -- \u662f\u5426\u5b58\u5728\u5bf9\u5e94\u952e\u503c\nend\n\nfunction DataTableSet:GetMessageDescriptor()\n    return self.__message_descriptor\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"DataTableCustomIndexUpb.lua"})," \u4f1a\u5305\u542b ",(0,t.jsx)(n.code,{children:"luaPath"}),"\u3001",(0,t.jsx)(n.code,{children:"messageName"}),"\u3001",(0,t.jsx)(n.code,{children:"keys"})," \u7b49\u914d\u7f6e\uff0c\u4f9b DataTableSet \u5ef6\u8fdf\u52a0\u8f7d\u3002"]})]})}function i(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},5739:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var r=a(6363);const t={},l=r.createContext(t);function s(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);