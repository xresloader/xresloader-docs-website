<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>快速上手 &mdash; xresloader-document https://xresloader.atframe.work 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1fb93e06" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=26a91e76"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="关于此文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="转表引擎-xresloader" href="xresloader_core.html" />
    <link rel="prev" title="下载工具集" href="download.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            xresloader-document
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">用户文档</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="download.html">下载工具集</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">快速上手</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1">Step-1: 下载转表工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-protobufprotoc">Step-2: 配置结构化的protobuf协议并使用protoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-excel">Step-3: 配置Excel数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4">Step-4: 配置批量转表配置文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5">Step-5: 运行转表工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-5-1">Step-5.1: 命令行批量转表工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-2-gui">Step-5.2: GUI批量转表工具</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-6">Step-6: 加载数据</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-6-1-xres-code-generator-c-lua-c-upb-lua-ue">Step-6.1: （推荐）使用 xres-code-generator 生成解析代码(C++/Lua/C#/Upb Lua//UE蓝图)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-2">Step-6.2: 手动解析</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-3-6-1">Step-6.3: （老式接口，不推荐，请考虑使用上面6.1的加载方法）使用读取库模板解析</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proto-v2">使用proto v2加载二进制数据的特别注意事项</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xresloader_core.html">转表引擎-xresloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_mapping.html">协议-&gt;Excel数据映射和支持的配置读取源 （scheme）</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_format.html">数据输出和数据加载</a></li>
<li class="toctree-l1"><a class="reference internal" href="xresconv.html">批量转表工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_types.html">数据类型说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="xres_code_generator.html">使用 xres-code-generator 生成解析代码</a></li>
<li class="toctree-l1"><a class="reference internal" href="advance_usage.html">高级功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem_and_tools.html">生态和周边工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">开发文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/dependency.html">环境和依赖项</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/build.html">编译和打包</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/pkg_source.html">使用国内的源</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/design_xresloader.html">转表引擎设计模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/design_xresconv.html">批量转表工具设计模型</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">关于 xresloader</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xresloader-document</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">快速上手</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/users/quick_start.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>快速上手<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<section id="step-1">
<h2>Step-1: 下载转表工具<a class="headerlink" href="#step-1" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>下载JRE/JDK 11或以上(推荐下载64位的: <a class="reference external" href="https://adoptium.net/">Adoptium OpenJDK</a>/<a class="reference external" href="https://bell-sw.com/">LibericaJDK</a>/<a class="reference external" href="https://developers.redhat.com/products/openjdk/download">OpenJDK</a>/<a class="reference external" href="https://www.azul.com/downloads/zulu-community/">Zulu</a>)</p></li>
<li><p>打开 <a class="reference internal" href="download.html"><span class="doc">下载工具集</span></a> 。下载最新版本的 <strong>转表工具-xresloader</strong> (xresloader-*.jar)。</p></li>
<li><p>下载或自己编译protobuf官方的protoc工具，可以去 <a class="reference external" href="https://github.com/google/protobuf/releases">https://github.com/google/protobuf/releases</a> 下载预编译好的protoc</p></li>
<li><p>[可选/推荐] 如果要使用命令行版本的批量转换工具则要额外下载 <strong>命令行批量转表工具-xresconv-cli</strong></p></li>
<li><p>[可选/推荐] 如果要使用GUI版本的批量转换工具则要额外下载 <strong>GUI批量转表工具-xresconv-gui</strong></p></li>
</ol>
</section>
<section id="step-2-protobufprotoc">
<h2>Step-2: 配置结构化的protobuf协议并使用protoc<a class="headerlink" href="#step-2-protobufprotoc" title="Link to this heading"></a></h2>
<p>我们需要先写协议描述文件，到时候转出的数据也是按这个结构打包的。比如： <a class="reference external" href="https://github.com/xresloader/xresloader-docs/blob/main/source/sample/quick_start/sample-conf/kind.proto">kind.proto</a></p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto3&quot;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s">&quot;xresloader.proto&quot;</span><span class="p">;</span>
<span class="c1">// xresloader的发布页面 https://github.com/xresloader/xresloader/releases 下载</span>
<span class="c1">// protocols.zip ，即可获取xresloader.proto</span>

<span class="kd">enum</span><span class="w"> </span><span class="n">cost_type</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">EN_CT_UNKNOWN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="na">EN_CT_MONEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10001</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="n">org.xresloader.enum_alias</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;金币&quot;</span><span class="w"> </span><span class="p">];</span>
<span class="w">  </span><span class="na">EN_CT_DIAMOND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10101</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">(</span><span class="n">org.xresloader.enum_alias</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;钻石&quot;</span><span class="w"> </span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">role_upgrade_cfg</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">uint32</span><span class="w"> </span><span class="na">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32</span><span class="w"> </span><span class="na">Level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32</span><span class="w"> </span><span class="na">CostType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">(</span><span class="n">org.xresloader.validator</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="s">&quot;cost_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// 这里等同于在Excel中使用 @cost_type 标识</span>
<span class="w">    </span><span class="p">(</span><span class="n">org.xresloader.field_description</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Refer to cost_type&quot;</span>
<span class="w">  </span><span class="p">];</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">CostValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int32</span><span class="w"> </span><span class="na">ScoreAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>proto v2也可以，可以参见 <a class="reference external" href="https://github.com/xresloader/xresloader/blob/main/sample/proto_v2/kind.proto">https://github.com/xresloader/xresloader/blob/main/sample/proto_v2/kind.proto</a> 。</p>
<p>然后使用protoc生成描述文件和用于加载的代码文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protoc</span> <span class="o">-</span><span class="n">o</span> <span class="n">sample</span><span class="o">-</span><span class="n">conf</span><span class="o">/</span><span class="n">kind</span><span class="o">.</span><span class="n">pb</span> <span class="o">--</span><span class="n">cpp_out</span> <span class="n">sample</span><span class="o">-</span><span class="n">code</span> <span class="o">-</span><span class="n">I</span> <span class="n">sample</span><span class="o">-</span><span class="n">conf</span> <span class="o">-</span><span class="n">I</span> <span class="o">&lt;</span><span class="n">xresloader协议目录</span><span class="o">&gt;/</span><span class="n">extensions</span><span class="o">/</span><span class="n">v3</span> <span class="o">-</span><span class="n">I</span> <span class="o">&lt;</span><span class="n">xresloader协议目录</span><span class="o">&gt;/</span><span class="n">extensions</span> <span class="n">sample</span><span class="o">-</span><span class="n">conf</span><span class="o">/</span><span class="n">kind</span><span class="o">.</span><span class="n">proto</span> <span class="o">&lt;</span><span class="n">xresloader协议目录</span><span class="o">&gt;/</span><span class="n">extensions</span><span class="o">/</span><span class="n">google</span><span class="o">/</span><span class="n">protobuf</span><span class="o">/</span><span class="n">descriptor</span><span class="o">.</span><span class="n">proto</span> <span class="o">&lt;</span><span class="n">xresloader协议目录</span><span class="o">&gt;/</span><span class="n">extensions</span><span class="o">/</span><span class="n">v3</span><span class="o">/</span><span class="n">xresloader</span><span class="o">.</span><span class="n">proto</span> <span class="o">&lt;</span><span class="n">xresloader协议目录</span><span class="o">&gt;/</span><span class="n">extensions</span><span class="o">/</span><span class="n">v3</span><span class="o">/</span><span class="n">xresloader_ue</span><span class="o">.</span><span class="n">proto</span>
</pre></div>
</div>
<p>这是最终的 <strong>数据转出目标</strong> 。</p>
</section>
<section id="step-3-excel">
<h2>Step-3: 配置Excel数据源<a class="headerlink" href="#step-3-excel" title="Link to this heading"></a></h2>
<p>按照协议的配置编辑Excel文件，<a class="reference external" href="https://github.com/xresloader/xresloader-docs/blob/main/source/sample/quick_start/sample-conf/role_tables.xlsx">role_tables.xlsx</a> ，我们使用表名 <code class="docutils literal notranslate"><span class="pre">upgrade_10001</span></code> 。
第一行设为描述，第二行设置为字段映射列，后面是数据(具体设置请参照 <a class="reference internal" href="#quick-start-configure-sheme"><span class="std std-ref">Step-4: 配置批量转表配置文件</span></a>)。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>角色ID</p></th>
<th class="head"><p>等级</p></th>
<th class="head"><p>货币类别</p></th>
<th class="head"><p>消耗值</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Id</p></td>
<td><p>Level</p></td>
<td><p>CostType</p></td>
<td><p>CostValue</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>1</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>10001</p></td>
<td><p>2</p></td>
<td><p>1001</p></td>
<td><p>50</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>3</p></td>
<td><p>1001</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>10001</p></td>
<td><p>4</p></td>
<td><p>1001</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>5</p></td>
<td><p>1001</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-even"><td><p>10001</p></td>
<td><p>6</p></td>
<td><p>1001</p></td>
<td><p>250</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>7</p></td>
<td><p>1001</p></td>
<td><p>300</p></td>
</tr>
<tr class="row-even"><td><p>10001</p></td>
<td><p>8</p></td>
<td><p>1001</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>9</p></td>
<td><p>1001</p></td>
<td><p>400</p></td>
</tr>
<tr class="row-even"><td><p>10001</p></td>
<td><p>10</p></td>
<td><p>1001</p></td>
<td><p>450</p></td>
</tr>
<tr class="row-odd"><td><p>10001</p></td>
<td><p>11</p></td>
<td><p>1001</p></td>
<td><p>500</p></td>
</tr>
</tbody>
</table>
<p>这是最终的 <strong>数据来源</strong> 。</p>
</section>
<section id="step-4">
<span id="quick-start-configure-sheme"></span><h2>Step-4: 配置批量转表配置文件<a class="headerlink" href="#step-4" title="Link to this heading"></a></h2>
<p>编辑配置转表配置， <a class="reference external" href="https://github.com/xresloader/xresloader-docs/blob/main/source/sample/quick_start/sample-conf/sample.xml">sample.xml</a> 。这个文件用于告诉批量转表工具，xresloader的位置、工作目录从哪里读协议描述文件，如果映射字段转成什么类型等等。
简而言之就是把 <strong>数据转出目标</strong> 和 <strong>数据来源</strong> 关联起来。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;root&gt;</span>
<span class="w">    </span><span class="nt">&lt;global&gt;</span>
<span class="w">        </span><span class="nt">&lt;work_dir</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;工作目录，相对于当前xml的目录，我们的Excel文件放在这里&quot;</span><span class="nt">&gt;</span>.<span class="nt">&lt;/work_dir&gt;</span>
<span class="w">        </span><span class="nt">&lt;xresloader_path</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;指向前面下载的 转表工具-xresloader，相对于当前xml的目录&quot;</span><span class="nt">&gt;</span>../xresloader/target/xresloader-2.9.0.jar<span class="nt">&lt;/xresloader_path&gt;</span>

<span class="w">        </span><span class="nt">&lt;proto</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;协议类型，-p选项&quot;</span><span class="nt">&gt;</span>protobuf<span class="nt">&lt;/proto&gt;</span>
<span class="w">        </span><span class="nt">&lt;output_type</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;输出类型，对应-t选项，输出二进制&quot;</span><span class="nt">&gt;</span>bin<span class="nt">&lt;/output_type&gt;</span>
<span class="w">        </span><span class="nt">&lt;output_type</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;多种输出时可以额外定义某个节点的重命名规则&quot;</span><span class="w"> </span><span class="na">rename=</span><span class="s">&quot;/(?i)\.bin$/\.json/&quot;</span><span class="nt">&gt;</span>json<span class="nt">&lt;/output_type&gt;</span>
<span class="w">        </span><span class="nt">&lt;proto_file</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;协议描述文件，-f选项&quot;</span><span class="nt">&gt;</span>kind.pb<span class="nt">&lt;/proto_file&gt;</span>

<span class="w">        </span><span class="nt">&lt;output_dir</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;输出目录，-o选项&quot;</span><span class="nt">&gt;</span>../sample-data<span class="nt">&lt;/output_dir&gt;</span>
<span class="w">        </span><span class="nt">&lt;data_src_dir</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;数据源目录，-d选项&quot;</span><span class="nt">&gt;&lt;/data_src_dir&gt;</span>

<span class="w">        </span><span class="nt">&lt;java_option</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;java选项-最大内存限制2GB&quot;</span><span class="nt">&gt;</span>-Xmx2048m<span class="nt">&lt;/java_option&gt;</span>
<span class="w">        </span><span class="nt">&lt;java_option</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;java选项-客户端模式&quot;</span><span class="nt">&gt;</span>-client<span class="nt">&lt;/java_option&gt;</span>

<span class="w">        </span><span class="nt">&lt;default_scheme</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;KeyRow&quot;</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;默认scheme模式参数-Key行号，对应上面Id、Level、CostType、CostValue那一行&quot;</span><span class="nt">&gt;</span>2<span class="nt">&lt;/default_scheme&gt;</span>
<span class="w">        </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;全局自定义选项&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;美化文本输出，缩进为2个空格&quot;</span><span class="nt">&gt;</span>--pretty<span class="w"> </span>2<span class="nt">&lt;/option&gt;</span>
<span class="w">    </span><span class="nt">&lt;/global&gt;</span>
<span class="w">    </span>
<span class="w">    </span><span class="nt">&lt;groups</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;分组信息（可选）&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;client&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;客户端&quot;</span><span class="nt">&gt;&lt;/group&gt;</span>
<span class="w">        </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;server&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;服务器&quot;</span><span class="nt">&gt;&lt;/group&gt;</span>
<span class="w">    </span><span class="nt">&lt;/groups&gt;</span>

<span class="w">    </span><span class="nt">&lt;category</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;类信息（用于GUI工具的树形结构分类显示）&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;tree</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;all_cats&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;大分类&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;tree</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;kind&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;角色配置&quot;</span><span class="nt">&gt;&lt;/tree&gt;</span>
<span class="w">        </span><span class="nt">&lt;/tree&gt;</span>
<span class="w">    </span><span class="nt">&lt;/category&gt;</span>

<span class="w">    </span><span class="nt">&lt;list&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;升级表&quot;</span><span class="w"> </span><span class="na">cat=</span><span class="s">&quot;kind&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;client server&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;scheme</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DataSource&quot;</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;数据源(文件名|表名|数据起始行号,数据起始列号)&quot;</span><span class="nt">&gt;</span>role_tables.xlsx|upgrade_10001|3,1<span class="nt">&lt;/scheme&gt;</span>
<span class="w">            </span><span class="nt">&lt;scheme</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ProtoName&quot;</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;协议名&quot;</span><span class="nt">&gt;</span>role_upgrade_cfg<span class="nt">&lt;/scheme&gt;</span>
<span class="w">            </span><span class="nt">&lt;scheme</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;OutputFile&quot;</span><span class="w"> </span><span class="na">desc=</span><span class="s">&quot;输出文件名&quot;</span><span class="nt">&gt;</span>role_upgrade_cfg.bin<span class="nt">&lt;/scheme&gt;</span>
<span class="w">        </span><span class="nt">&lt;/item&gt;</span>
<span class="w">    </span><span class="nt">&lt;/list&gt;</span>
<span class="nt">&lt;/root&gt;</span>
</pre></div>
</div>
<p>对于文件路径配置的说明: <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> 、 <code class="docutils literal notranslate"><span class="pre">xresloader_path</span></code> 和 <code class="docutils literal notranslate"><span class="pre">include</span></code> 配置的路径是相对于xml文件的路径。其他的涉及路径配置的地方如果不是绝对路径的，都是相对于 <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> 的路径。（具体含义请参考 <a class="reference internal" href="xresconv.html"><span class="doc">批量转表工具</span></a> ）</p>
<p>在查找Excel文件的时候，如果有配置 <code class="docutils literal notranslate"><span class="pre">data_src_dir</span></code> ，则会相对于这个配置的路径读取Excel，否则也是相对于 <code class="docutils literal notranslate"><span class="pre">work_dir</span></code> 。</p>
</section>
<section id="step-5">
<h2>Step-5: 运行转表工具<a class="headerlink" href="#step-5" title="Link to this heading"></a></h2>
<p>下面两种运行转表的工具，一种是命令行工具，另一种是有用户界面的GUI工具。选用一种即可。</p>
<p>我们假设执行环境的目录结构如下:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sample-conf<span class="w"> </span><span class="o">(</span>批量转表配置所在目录<span class="o">)</span>
<span class="w">  </span>sample.xml
<span class="w">  </span>kind.proto
<span class="w">  </span>kind.pb<span class="w">               </span>（使用protoc生成的二进制协议描述文件）
<span class="w">  </span>role_tables.xlsx<span class="w">      </span>（Excel数据源）
<span class="w">  </span>xresloader.run.log<span class="w">     </span><span class="o">(</span>输出的日志文件，执行转表后自动生成，方便万一有错误排查<span class="o">)</span>
sample-data<span class="w"> </span><span class="o">(</span>转出的配置数据所在目录<span class="o">)</span>
<span class="w">  </span>role_upgrade_cfg.bin<span class="w">  </span><span class="o">(</span>输出的二进制配置文件，执行转表后自动生成<span class="o">)</span>
xresloader
<span class="w">  </span>header<span class="w">                </span><span class="o">(</span>可在<span class="w"> </span>https://github.com/xresloader/xresloader/releases<span class="w"> </span>下载<span class="w"> </span>protocols.zip<span class="w"> </span>获得<span class="o">)</span>
<span class="w">    </span>pb_header.proto<span class="w">    </span>（用于proto<span class="w"> </span>v2的转表头结构描述文件，读取数据的时候用）
<span class="w">    </span>pb_header_v3.proto<span class="w"> </span>（用于proto<span class="w"> </span>v3的转表头结构描述文件，读取数据的时候用）
<span class="w">  </span>target<span class="w">                </span><span class="o">(</span>可在<span class="w"> </span>https://github.com/xresloader/xresloader/releases<span class="w"> </span>下载<span class="w"> </span>xresloader-<span class="se">\*</span>.jar<span class="w"> </span>获得<span class="o">)</span>
<span class="w">    </span>xresloader-2.8.0.jar
xresconv-cli<span class="w">              </span><span class="o">(</span>命令行转表工具所在目录，可在<span class="w"> </span>https://github.com/xresloader/xresconv-cli/releases<span class="w"> </span>下载<span class="w"> </span><span class="o">)</span>
<span class="w">  </span>xresconv-cli.py
<span class="w">  </span>print_color.py
xresconv-gui<span class="w">              </span><span class="o">(</span>GUI转表工具所在目录，可在<span class="w"> </span>https://github.com/xresloader/xresconv-gui/releases<span class="w"> </span>下载<span class="w"> </span><span class="o">)</span>
<span class="w">  </span>GUI工具的文件列表...
</pre></div>
</div>
<section id="step-5-1">
<h3>Step-5.1: 命令行批量转表工具<a class="headerlink" href="#step-5-1" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>xresconv-cli/xresconv-cli.py<span class="w"> </span>sample-conf/sample.xml
</pre></div>
</div>
<p>输出如下:</p>
<img alt="../_images/quick_start_cli_sample.gif" src="../_images/quick_start_cli_sample.gif" />
</section>
<section id="step-5-2-gui">
<h3>Step-5.2: GUI批量转表工具<a class="headerlink" href="#step-5-2-gui" title="Link to this heading"></a></h3>
<p>使用GUI工具，直接加载配置文件，选中要转换的表然后点击开始即可。</p>
<img alt="../_images/quick_start_gui_sample.gif" src="../_images/quick_start_gui_sample.gif" />
</section>
</section>
<section id="step-6">
<h2>Step-6: 加载数据<a class="headerlink" href="#step-6" title="Link to this heading"></a></h2>
<p>执行完上面一步的转表流程后，我们得到了 <code class="docutils literal notranslate"><span class="pre">xresloader/sample/role_upgrade_cfg.bin</span></code> 这个二进制配置文件，接下来把它加载到我们的程序中就可以了。</p>
<p>比如我们用C++来加载。首先我们之前执行 <code class="docutils literal notranslate"><span class="pre">protoc</span></code> 的时候已经生成了配置协议的代码，然后还需要生成转表工具header的结构的代码。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">protoc</span> <span class="o">-</span><span class="n">I</span> <span class="n">xresloader</span><span class="o">/</span><span class="n">third_party</span><span class="o">/</span><span class="n">xresloader</span><span class="o">-</span><span class="n">protocol</span><span class="o">/</span><span class="n">core</span><span class="o">/</span> <span class="o">--</span><span class="n">cpp_out</span><span class="o">=</span><span class="n">sample</span><span class="o">-</span><span class="n">code</span> <span class="n">xresloader</span><span class="o">/</span><span class="n">third_party</span><span class="o">/</span><span class="n">xresloader</span><span class="o">-</span><span class="n">protocol</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">pb_header_v3</span><span class="o">.</span><span class="n">proto</span> <span class="p">;</span>
</pre></div>
</div>
<p>然后你可以选择使用我们封装过的读取库解析或手动解析。</p>
<section id="step-6-1-xres-code-generator-c-lua-c-upb-lua-ue">
<span id="quick-start-load-with-libresloader"></span><h3>Step-6.1: （推荐）使用 <a class="reference external" href="https://github.com/xresloader/xres-code-generator">xres-code-generator</a> 生成解析代码(C++/Lua/C#/Upb Lua//UE蓝图)<a class="headerlink" href="#step-6-1-xres-code-generator-c-lua-c-upb-lua-ue" title="Link to this heading"></a></h3>
<p>对于C++、Lua和C#，我们推荐使用 <a class="reference external" href="https://github.com/xresloader/xres-code-generator">xres-code-generator</a> 生成解析代码。（未来会开发更多的语言支持）。详见： <a class="reference internal" href="xres_code_generator.html#id2"><span class="std std-ref">使用 xres-code-generator 生成解析代码</span></a> 。</p>
</section>
<section id="step-6-2">
<h3>Step-6.2: 手动解析<a class="headerlink" href="#step-6-2" title="Link to this heading"></a></h3>
<p>手动解析的流程是先用 <a class="reference external" href="https://github.com/xresloader/xresloader-protocol/blob/main/core/pb_header_v3.proto">xresloader中header</a> 里的 <code class="docutils literal notranslate"><span class="pre">xresloader_datablocks</span></code> 解析二进制文件，然后用协议的proto解析里面每条 <code class="docutils literal notranslate"><span class="pre">data_block</span></code> 字段。
每个 <code class="docutils literal notranslate"><span class="pre">data_block</span></code> 的条目对应配置里协议的每个message。（文件名: <a class="reference external" href="https://github.com/xresloader/xresloader-docs/blob/main/source/sample/quick_start/sample-code/load_custom.cpp">load_custom.cpp</a> ）：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;google/protobuf/stubs/common.h&gt;</span>

<span class="cp">#if GOOGLE_PROTOBUF_VERSION &lt; 3000000</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pb_header.pb.h&quot;</span>
<span class="cp">#else</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pb_header_v3.pb.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;kind.pb.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../sample-data/role_upgrade_cfg.bin&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;usage: %s &lt;path to role_upgrade_cfg.bin&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">org</span><span class="o">::</span><span class="n">xresloader</span><span class="o">::</span><span class="n">pb</span><span class="o">::</span><span class="n">xresloader_datablocks</span><span class="w"> </span><span class="n">data_wrapper</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">fstream</span><span class="w"> </span><span class="n">fin</span><span class="p">;</span>
<span class="w">    </span><span class="n">fin</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fin</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;open %s failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">file_path</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">false</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">data_wrapper</span><span class="p">.</span><span class="n">ParseFromIstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fin</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parse org::xresloader::pb::xresloader_datablocks failed. %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data_wrapper</span><span class="p">.</span><span class="n">InitializationErrorString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;========================</span><span class="se">\n</span><span class="s">data header: %s</span><span class="se">\n</span><span class="s">========================</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data_wrapper</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">DebugString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">data_wrapper</span><span class="p">.</span><span class="n">data_block_size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">role_upgrade_cfg</span><span class="w"> </span><span class="n">role_upg_data</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">false</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">role_upg_data</span><span class="p">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">data_wrapper</span><span class="p">.</span><span class="n">data_block</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parse role_upgrade_cfg for index %d failed. %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">role_upg_data</span><span class="p">.</span><span class="n">InitializationErrorString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;role_upgrade_cfg =&gt; index %d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">role_upg_data</span><span class="p">.</span><span class="n">ShortDebugString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>编译和运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>g++<span class="w"> </span>-I<span class="w"> </span>.<span class="w"> </span>-I&lt;protobuf的include目录&gt;<span class="w"> </span>-L&lt;protobuf的lib目录&gt;<span class="w"> </span>-std<span class="o">=</span>c++11<span class="w"> </span>-O0<span class="w"> </span>-g<span class="w"> </span>-ggdb<span class="w"> </span>-Wall<span class="w"> </span>load_custom.cpp<span class="w"> </span>*.pb.cc<span class="w"> </span>-lprotobuf<span class="w"> </span>-o<span class="w"> </span>load_custom.exe<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./load_custom.exe<span class="w"> </span>../sample-data/role_upgrade_cfg.bin
</pre></div>
</div>
<p>输出示例：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">========================</span>
data<span class="w"> </span>header:<span class="w"> </span>xres_ver:<span class="w"> </span><span class="s2">&quot;1.4.3&quot;</span>
data_ver:<span class="w"> </span><span class="s2">&quot;1.4.3.20180317040504&quot;</span>
count:<span class="w"> </span><span class="m">11</span>
hash_code:<span class="w"> </span><span class="s2">&quot;md5:7bbe88cca1eb23ebdce75b0e10b88b4a&quot;</span>

<span class="o">========================</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">1</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">2</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">50</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">3</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">100</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">4</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">150</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">5</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">200</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">6</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">250</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">6</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">7</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">300</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">7</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">8</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">350</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">8</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">9</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">400</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">9</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">10</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">450</span>
<span class="nv">role_upgrade_cfg</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>index<span class="w"> </span><span class="m">10</span>:<span class="w"> </span>Id:<span class="w"> </span><span class="m">10001</span><span class="w"> </span>Level:<span class="w"> </span><span class="m">11</span><span class="w"> </span>CostType:<span class="w"> </span><span class="m">1001</span><span class="w"> </span>CostValue:<span class="w"> </span><span class="m">500</span>
</pre></div>
</div>
<p>加载数据可以有多种方法，这里提供加载二进制的方法。 更多关于输出类型和加载方式的信息请参见 <a class="reference internal" href="output_format.html"><span class="doc">数据输出和数据加载</span></a> 。</p>
</section>
<section id="step-6-3-6-1">
<h3>Step-6.3: （老式接口，不推荐，请考虑使用上面6.1的加载方法）使用读取库模板解析<a class="headerlink" href="#step-6-3-6-1" title="Link to this heading"></a></h3>
<p>需要先下载读取库。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">k</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">xresloader</span><span class="o">/</span><span class="n">xresloader</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">loader</span><span class="o">-</span><span class="n">binding</span><span class="o">/</span><span class="n">cxx</span><span class="o">/</span><span class="n">libresloader</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span><span class="n">o</span> <span class="n">libresloader</span><span class="o">.</span><span class="n">h</span>
</pre></div>
</div>
<p>然后读取的代码sample如下（文件名: <a class="reference external" href="https://github.com/xresloader/xresloader-docs/blob/main/source/sample/quick_start/sample-code/load_with_libresloader.cpp">load_with_libresloader.cpp</a> ）</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;kind.pb.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;libresloader.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../sample-data/role_upgrade_cfg.bin&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;usage: %s &lt;path to role_upgrade_cfg.bin&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// key - value 型数据读取机制</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">typedef</span><span class="w"> </span><span class="n">xresloader</span><span class="o">::</span><span class="n">conf_manager_kv</span><span class="o">&lt;</span><span class="n">role_upgrade_cfg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kind_upg_cfg_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">kind_upg_cfg_t</span><span class="w"> </span><span class="n">upg_mgr</span><span class="p">;</span>
<span class="w">        </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">set_key_handle</span><span class="p">([](</span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">value_type</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">key_type</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">level</span><span class="p">());</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">);</span>

<span class="w">        </span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">value_type</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">10001</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取Key 为 10001,4的条目</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">data1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;role_upgrade_cfg id: 10001, level: 4 not found, load file &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">file_path</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; failed.&quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="o">-&gt;</span><span class="n">DebugString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// key - list 型数据读取机制</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">typedef</span><span class="w"> </span><span class="n">xresloader</span><span class="o">::</span><span class="n">conf_manager_kl</span><span class="o">&lt;</span><span class="n">role_upgrade_cfg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kind_upg_cfg_t</span><span class="p">;</span>
<span class="w">        </span><span class="n">kind_upg_cfg_t</span><span class="w"> </span><span class="n">upg_mgr</span><span class="p">;</span>
<span class="w">        </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">set_key_handle</span><span class="p">([](</span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">value_type</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">key_type</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">());</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;role_upgrade_cfg with id=%d has %llu items</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10001</span><span class="p">,</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">get_list</span><span class="p">(</span><span class="mi">10001</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()));</span>

<span class="w">        </span><span class="n">kind_upg_cfg_t</span><span class="o">::</span><span class="n">value_type</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upg_mgr</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">10001</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// 获取Key 为 10001 下标为0（就是第一个）条目</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">NULL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">data1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;role_upgrade_cfg id: 10001 , index: 0, not found, load file &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">file_path</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; failed.&quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data1</span><span class="o">-&gt;</span><span class="n">DebugString</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>编译和运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>g++<span class="w"> </span>-I<span class="w"> </span>.<span class="w"> </span>-I&lt;protobuf的include目录&gt;<span class="w"> </span>-L&lt;protobuf的lib目录&gt;<span class="w"> </span>-std<span class="o">=</span>c++11<span class="w"> </span>-O0<span class="w"> </span>-g<span class="w"> </span>-ggdb<span class="w"> </span>-Wall<span class="w"> </span>load_with_libresloader.cpp<span class="w"> </span>*.pb.cc<span class="w"> </span>-lprotobuf<span class="w"> </span>-o<span class="w"> </span>load_with_libresloader.exe<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./load_with_libresloader.exe<span class="w"> </span>../sample-data/role_upgrade_cfg.bin
</pre></div>
</div>
<p>输出示例：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Id:<span class="w"> </span><span class="m">10001</span>
Level:<span class="w"> </span><span class="m">4</span>
CostType:<span class="w"> </span><span class="m">1001</span>
CostValue:<span class="w"> </span><span class="m">150</span>

role_upgrade_cfg<span class="w"> </span>with<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">10001</span><span class="w"> </span>has<span class="w"> </span><span class="m">11</span><span class="w"> </span>items
Id:<span class="w"> </span><span class="m">10001</span>
Level:<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>上面的例程和配置可以在 <a class="reference external" href="https://github.com/xresloader/xresloader-docs/tree/main/source/sample/quick_start">https://github.com/xresloader/xresloader-docs/tree/main/source/sample/quick_start</a> 查看。</p>
</section>
</section>
<section id="proto-v2">
<h2>使用proto v2加载二进制数据的特别注意事项<a class="headerlink" href="#proto-v2" title="Link to this heading"></a></h2>
<p>需要额外注意一点的是，如果使用proto v2生成的代码或pb加载转出的数据，如果有 <code class="docutils literal notranslate"><span class="pre">repeated</span></code> 的数字字段，需要在proto文件里显式指明 <code class="docutils literal notranslate"><span class="pre">packed</span></code> 属性。</p>
<p>详见 <a class="reference internal" href="output_format.html#output-format-proto-v2-and-proto-v3"><span class="std std-ref">Proto v2和Proto v3</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="download.html" class="btn btn-neutral float-left" title="下载工具集" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="xresloader_core.html" class="btn btn-neutral float-right" title="转表引擎-xresloader" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2024, xresloader。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>